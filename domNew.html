<!DOCTYPE html>
<html>

<head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="container">
        <ul class="comments" id="comment-list">
            <!-- <li class="comment">
                <div class="comment-header">
                    <div>Глеб Фокин</div>
                    <div class="comment-date">12.02.22 12:18</div>
                </div>
                <div class="comment-body">
                    <div class="comment-text">
                        Это будет первый комментарий на этой странице
                    </div>
                </div>
                <div class="comment-footer">
                    <div class="likes">
                        <span class="likes-counter">3</span>
                        <button class="like-button"></button>
                    </div>
                </div>
            </li>
            <li class="comment">
                <div class="comment-header">
                    <div>Варвара Н.</div>
                    <div>13.02.22 19:22</div>
                </div>
                <div class="comment-body">
                    <div class="comment-text">
                        Мне нравится как оформлена эта страница! ❤️
                    </div>
                </div>
                <div class="comment-footer">
                    <div class="likes">
                        <span class="likes-counter">75</span>
                        <button class="like-button active-like"></button>
                    </div>
                </div>
            </li> -->
        </ul>
        <div class="add-form">
            <input type="text" class="add-form-name" placeholder="Введите ваше имя" id="name-input" />
            <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4"
                id="comment-input"></textarea>
            <div class="add-form-row">
                <button class="add-form-button" id="add-comment-button">Написать</button>
            </div>
        </div>
    </div>
    <script>
        'use strict';
        const buttonElement = document.getElementById('add-comment-button');
        const listElement = document.getElementById('comment-list');
        const nameInputElement = document.getElementById('name-input');
        const commentInputElement = document.getElementById('comment-input');

        const users = [
            {
                name: 'Глеб Фокин',
                time: '12.02.22 12:18',
                comment: 'Это будет первый комментарий на этой странице',
                likesCount: 3,
                isLiked: false,
            },
            {
                name: 'Варвара Н.',
                time: '13.02.22 19:22',
                comment: 'Мне нравится как оформлена эта страница!❤️',
                likesCount: 75,
                isLiked: true,
            },
        ];

        function initLikeButtons() {

            const likeButtons = document.querySelectorAll(".like-button");

            likeButtons.forEach((button) => {
                button.addEventListener("click", (event) => {
                    const userIndex = event.target.dataset.index;
                    const user = users[userIndex];
                    const likeIcon = event.target.querySelector(".like-icon");

                    if (user.isLiked) {
                        user.likesCount--;
                        user.isLiked = false;
                        if (likeIcon) {
                            likeIcon.classList.remove("-active-like");
                        }
                    } else {
                        user.likesCount++;
                        user.isLiked = true;
                        if (likeIcon) {
                            likeIcon.classList.add("-active-like");
                        }
                    }
                    renderUsers();
                });
            });
        }
        const renderUsers = () => {
            const usersHTML = users.map((user, index) => {
                return `
                <li class="comment">
                    <div class="comment-header">
                    <div>${user.name}</div>
                    <div class="comment-date">${user.time}</div>
                    </div>
                    <div class="comment-body">
                    <div class="comment-text">
                        ${user.comment}
                    </div>
                    </div>
                    <div class="comment-footer">
                    <div class="likes">
                        <span class="likes-counter">${user.likesCount}</span>
                        <button class="like-button ${user.isLiked ? 'active-like' : ''}" data-index='${index}'></button>
                    </div>
                    </div>
                </li>
                `;
            }).join("");

            listElement.innerHTML = usersHTML;
            initLikeButtons();
        };

        renderUsers();

        buttonElement.addEventListener("click", () => {
            if (nameInputElement.value === "" || commentInputElement.value === "") {
                buttonElement.disabled = true;
                return;
            }

            users.push({
                name: nameInputElement.value,
                time: getCurrentDate(new Date()),
                comment: commentInputElement.value,
                likesCount: 0,
                isLiked: false,
            });

            renderUsers();
            nameInputElement.value = "";
            commentInputElement.value = "";
        });

        function getCurrentDate(date) {
            let day = date.getDate();
            if (day < 10) day = '0' + day;
            let month = date.getMonth() + 1;
            if (month < 10) month = '0' + month;
            let hour = date.getHours();
            if (hour < 10) hour = '0' + hour;
            let minute = date.getMinutes();
            if (minute < 10) minute = '0' + minute;
            return day + '.' + month + '.' + (date.getFullYear() % 100) + ' ' + hour + ':' + minute;
        }
    </script>
</body>

</html>